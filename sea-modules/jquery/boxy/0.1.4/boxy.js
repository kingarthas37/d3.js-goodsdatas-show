/*!

JYJCnCJCnttjv      iICttntntnCzU   YvivivYY     viivvvYY
ztFUIbEQEEApUbo    tdUzpZbbEbEEB   viiiiiSbi   iiijCjXCz
nYJCziiiiiSnJJPU   nFCoXvvvvccCS   viiiiiitC   i vYiviYC
CYCJF      ICJFO   UStoi           pXciiiiiI   ivcivvjtI
tvCCziiiiiCJnSdi   IoCoiiYnCji     tjYjjYiiii iivvjjjYCn 
CYXtCZbOEEoJtv     EIFSPEQdpIPZo   SvvciiJviiiivvJivjjCo
tYCCSCCttCAtnjv   ionJAjiiinoCSAU  BbPQc QddBBQUzz YAnpd
CYCnI      FCSzOi           zJCzb  BpAbJ BBBMMMBMp SSCSd
JcCCA      SJCSAj njCtj    iICtob  QpZMO iMMMBBMMi BBIoF
CYCnoiiiiiCFCJoEi CBZAAPCjtAnoFbi  MBBMW  MMMMBMM  MMBMM
ACUFAbQEQbdUPPbi   iFZbPbbbAPPzi   MMMMB  QMMMMMj  MMMMM
jcjXjCjCXtYYii        iYjXjYi      MQQBb   MMBBM   BBBBM
 
--------------------------------------------------------
帮5买（www.b5m.com）
开发人员：尹正飞(qq:657812595) 杨建远(qq:690492623)
2013-11-07
--------------------------------------------------------

*/
function Boxy(e,t){this.boxy=jQuery(Boxy.WRAPPER),jQuery.data(this.boxy[0],"boxy",this),this.visible=!1,this.options=jQuery.extend({},Boxy.DEFAULTS,t||{}),this.options.modal&&(this.options=jQuery.extend(this.options,{center:!0,draggable:!1})),this.options.actuator&&jQuery.data(this.options.actuator,"active.boxy",this),this.setContent(e||"<div></div>"),this._setupTitleBar(),this.boxy.css("display","none").appendTo(document.body),this.toTop(),this.options.fixed&&(Boxy.IE6?this.options.fixed=!1:this.boxy.addClass("fixed")),this.options.center&&Boxy._u(this.options.x,this.options.y)?this.center():this.moveTo(Boxy._u(this.options.x)?Boxy.DEFAULT_X:this.options.x,Boxy._u(this.options.y)?Boxy.DEFAULT_Y:this.options.y),this.options.show&&this.show()}jQuery.fn.boxy=function(e){return e=e||{},this.each(function(){var t=this.nodeName.toLowerCase(),n=this;"a"==t?jQuery(this).click(function(){var t=Boxy.linkedTo(this),n=this.getAttribute("href"),i=jQuery.extend({actuator:this,title:this.title},e);if(n.match(/(&|\?)boxy\.modal/)&&(i.modal=!0),t)t.show();else if(n.indexOf("#")>=0){var a=jQuery(n.substr(n.indexOf("#"))),o=a.clone(!0);a.remove(),i.unloadOnHide=!1,new Boxy(o,i)}else n.match(/\.(jpe?g|png|gif|bmp)($|\?)/i)?(i.unloadOnHide=!0,Boxy.loadImage(this.href,i)):(i.cache||(i.unloadOnHide=!0),Boxy.load(this.href,i));return!1}):"form"==t&&jQuery(this).bind("submit.boxy",function(){return Boxy.confirm(e.message||"Please confirm:",function(){jQuery(n).unbind("submit.boxy").submit()}),!1})})},Boxy.EF=function(){},jQuery.extend(Boxy,{WRAPPER:"<table cellspacing='0' cellpadding='0' border='0' class='boxy-wrapper' style='width:auto;table-layout:auto;position:absolute;'><tr><td class='boxy-top-left'></td><td class='boxy-top'></td><td class='boxy-top-right'></td></tr><tr><td class='boxy-left'></td><td class='boxy-inner'></td><td class='boxy-right'></td></tr><tr><td class='boxy-bottom-left'></td><td class='boxy-bottom'></td><td class='boxy-bottom-right'></td></tr></table>",DEFAULTS:{id:"",title:null,closeable:!0,draggable:!0,clone:!1,actuator:null,center:!0,show:!0,modal:!1,fixed:!0,closeText:"关闭",unloadOnHide:!1,clickToFront:!1,behaviours:Boxy.EF,afterDrop:Boxy.EF,afterShow:Boxy.EF,afterHide:Boxy.EF,beforeUnload:Boxy.EF,hideFade:!1,hideShrink:"vertical"},IE6:jQuery.browser.msie&&7>jQuery.browser.version,DEFAULT_X:50,DEFAULT_Y:50,MODAL_OPACITY:.7,zIndex:1337,dragConfigured:!1,resizeConfigured:!1,dragging:null,load:function(e,t){t=t||{};var n={url:e,type:"GET",dataType:"html",cache:!1,success:function(e){e=jQuery(e),t.filter&&(e=jQuery(t.filter,e)),new Boxy(e,t)}};jQuery.each(["type","cache"],function(){this in t&&(n[this]=t[this],delete t[this])}),jQuery.ajax(n)},loadImage:function(e,t){var n=new Image;n.onload=function(){new Boxy($('<div class="boxy-image-wrapper"/>').append(this),t)},n.src=e},get:function(e){var t=jQuery(e).parents(".boxy-wrapper");return t.length?jQuery.data(t[0],"boxy"):null},linkedTo:function(e){return jQuery.data(e,"active.boxy")},alert:function(e,t,n){return Boxy.ask(e,["OK"],t,n)},confirm:function(e,t,n){return Boxy.ask(e,["OK","Cancel"],function(e){"OK"==e&&t()},n)},ask:function(e,t,n,i){i=jQuery.extend({modal:!0,closeable:!1},i||{},{show:!0,unloadOnHide:!0});var a=jQuery("<div></div>").append(jQuery('<div class="question"></div>').html(e)),o=jQuery('<form class="answers"></form>');o.html(jQuery.map(Boxy._values(t),function(e){return"<input type='button' value='"+e+"' />"}).join(" ")),jQuery("input[type=button]",o).click(function(){var e=this;Boxy.get(this).hide(function(){n&&jQuery.each(t,function(i,a){return a==e.value?(n(t instanceof Array?a:i),!1):void 0})})}),a.append(o),new Boxy(a,i)},isModalVisible:function(){return jQuery(".boxy-modal-blackout").length>0},_u:function(){for(var e=0;arguments.length>e;e++)if(arguments[e]!==void 0)return!1;return!0},_values:function(e){if(e instanceof Array)return e;var t=[];for(var n in e)t.push(e[n]);return t},_handleResize:function(){jQuery(".boxy-modal-blackout").css("display","none").css(Boxy._cssForOverlay()).css("display","block")},_handleDrag:function(e){var t;(t=Boxy.dragging)&&t[0].boxy.css({left:e.pageX-t[1],top:e.pageY-t[2]})},_nextZ:function(){return Boxy.zIndex++},_viewport:function(){var e=document.documentElement,t=document.body,n=window;return jQuery.extend(jQuery.browser.msie?{left:t.scrollLeft||e.scrollLeft,top:t.scrollTop||e.scrollTop}:{left:n.pageXOffset,top:n.pageYOffset},Boxy._u(n.innerWidth)?Boxy._u(e)||Boxy._u(e.clientWidth)||0==e.clientWidth?{width:t.clientWidth,height:t.clientHeight}:{width:e.clientWidth,height:e.clientHeight}:{width:n.innerWidth,height:n.innerHeight})},_setupModalResizing:function(){if(!Boxy.resizeConfigured){var e=jQuery(window).resize(Boxy._handleResize);Boxy.IE6&&e.scroll(Boxy._handleResize),Boxy.resizeConfigured=!0}},_cssForOverlay:function(){return Boxy.IE6?Boxy._viewport():{width:"100%",height:jQuery(document).height()}}}),Boxy.prototype={estimateSize:function(){this.boxy.css({visibility:"hidden",display:"block"});var e=this.getSize();return this.boxy.css("display","none").css("visibility","visible"),e},getSize:function(){return[this.boxy.width(),this.boxy.height()]},getContentSize:function(){var e=this.getContent();return[e.width(),e.height()]},getPosition:function(){var e=this.boxy[0];return[e.offsetLeft,e.offsetTop]},getCenter:function(){var e=this.getPosition(),t=this.getSize();return[Math.floor(e[0]+t[0]/2),Math.floor(e[1]+t[1]/2)]},getInner:function(){return jQuery(".boxy-inner",this.boxy)},getContent:function(){return jQuery(".boxy-content",this.boxy)},setContent:function(e){return e=jQuery(e).css({display:"block"}).addClass("boxy-content"),this.options.clone&&(e=e.clone(!0)),this.getContent().remove(),this.getInner().append(e),this._setupDefaultBehaviours(e),this.options.behaviours.call(this,e),this},moveTo:function(e,t){return this.moveToX(e).moveToY(t),this},moveToX:function(e){return"number"==typeof e?this.boxy.css({left:e}):this.centerX(),this},moveToY:function(e){return"number"==typeof e?this.boxy.css({top:e}):this.centerY(),this},centerAt:function(e,t){var n=this[this.visible?"getSize":"estimateSize"]();return"number"==typeof e&&this.moveToX(e-n[0]/2),"number"==typeof t&&this.moveToY(t-n[1]/2),this},centerAtX:function(e){return this.centerAt(e,null)},centerAtY:function(e){return this.centerAt(null,e)},center:function(e){var t=Boxy._viewport(),n=this.options.fixed?[0,0]:[t.left,t.top];return e&&"x"!=e||this.centerAt(n[0]+t.width/2,null),e&&"y"!=e||this.centerAt(null,n[1]+t.height/2),this},centerX:function(){return this.center("x")},centerY:function(){return this.center("y")},resize:function(e,t,n){if(this.visible){var i=this._getBoundsForResize(e,t);return this.boxy.css({left:i[0],top:i[1]}),this.getContent().css({width:i[2],height:i[3]}),n&&n(this),this}},tween:function(e,t,n){if(this.visible){var i=this._getBoundsForResize(e,t),a=this;return this.boxy.stop().animate({left:i[0],top:i[1]}),this.getContent().stop().animate({width:i[2],height:i[3]},function(){n&&n(a)}),this}},isVisible:function(){return this.visible},show:function(){if(!this.visible){if(this.options.modal){var e=this;Boxy._setupModalResizing(),this.modalBlackout=jQuery('<div class="boxy-modal-blackout"></div>').css(jQuery.extend(Boxy._cssForOverlay(),{zIndex:Boxy._nextZ(),opacity:Boxy.MODAL_OPACITY})).appendTo(document.body),this.toTop(),this.options.closeable&&jQuery(document.body).bind("keypress.boxy",function(t){var n=t.which||t.keyCode;27==n&&(e.hide(),jQuery(document.body).unbind("keypress.boxy"))})}return this.getInner().stop().css({width:"",height:""}),this.boxy.stop().css({opacity:1}).show(),this.visible=!0,this.boxy.find(".close:first").focus(),this._fire("afterShow"),this}},hide:function(e){if(this.visible){var t=this;this.options.modal&&(jQuery(document.body).unbind("keypress.boxy"),this.modalBlackout.animate({opacity:0},function(){jQuery(this).remove()}));var n={boxy:{},inner:{}},i=0,a=function(){t.boxy.css({display:"none"}),t.visible=!1,t._fire("afterHide"),e&&e(t),t.options.unloadOnHide&&t.unload()};if(this.options.hideShrink){var o=this.getInner(),r=this.options.hideShrink,s=this.getPosition();i|=1,(r===!0||"vertical"==r)&&(n.inner.height=0,n.boxy.top=s[1]+o.height()/2),(r===!0||"horizontal"==r)&&(n.inner.width=0,n.boxy.left=s[0]+o.width()/2)}return this.options.hideFade&&(i|=2,n.boxy.opacity=0),i?(1&i&&o.stop().animate(n.inner,300),this.boxy.stop().animate(n.boxy,300,a)):a(),this}},toggle:function(){return this[this.visible?"hide":"show"](),this},hideAndUnload:function(e){return this.options.unloadOnHide=!0,this.hide(e),this},unload:function(){this._fire("beforeUnload"),this.boxy.remove(),this.options.actuator&&jQuery.data(this.options.actuator,"active.boxy",!1)},toTop:function(){return this.boxy.css({zIndex:Boxy._nextZ()}),this},getTitle:function(){return jQuery("> .title-bar h2",this.getInner()).html()},setTitle:function(e){return jQuery("> .title-bar h2",this.getInner()).html(e),this},_getBoundsForResize:function(e,t){var n=this.getContentSize(),i=[e-n[0],t-n[1]],a=this.getPosition();return[Math.max(a[0]-i[0]/2,0),Math.max(a[1]-i[1]/2,0),e,t]},_setupTitleBar:function(){if(this.options.title){var e=this,t=jQuery("<div class='title-bar'></div>").html("<h2>"+this.options.title+"</h2>");this.options.closeable&&t.append(jQuery("<a href='#' class='close'></a>").html(this.options.closeText)),this.options.draggable&&(t[0].onselectstart=function(){return!1},t[0].unselectable="on",t[0].style.MozUserSelect="none",Boxy.dragConfigured||(jQuery(document).mousemove(Boxy._handleDrag),Boxy.dragConfigured=!0),t.mousedown(function(t){e.toTop(),Boxy.dragging=[e,t.pageX-e.boxy[0].offsetLeft,t.pageY-e.boxy[0].offsetTop],jQuery(this).addClass("dragging")}).mouseup(function(){jQuery(this).removeClass("dragging"),Boxy.dragging=null,e._fire("afterDrop")})),this.getInner().prepend(t),this._setupDefaultBehaviours(t)}},_setupDefaultBehaviours:function(e){var t=this;this.options.clickToFront&&e.click(function(){t.toTop()}),jQuery(".close",e).click(function(){return t.hide(),!1}).mousedown(function(e){e.stopPropagation()})},_fire:function(e){this.options[e].call(this)}},"object"==typeof module&&module&&"object"==typeof module.exports?module.exports=Boxy:"function"==typeof define&&define("jquery/boxy/0.1.4/boxy",["jquery/boxy/0.1.4/boxy.css"],function(){return Boxy});