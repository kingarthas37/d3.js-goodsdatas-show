define("arale/autocomplete/1.3.0/textarea-complete",["$","gallery/selection/0.9.0/selection","./autocomplete","arale/overlay/1.1.2/overlay","arale/position/1.0.1/position","arale/iframe-shim/1.0.2/iframe-shim","arale/widget/1.1.1/widget","arale/base/1.1.1/base","arale/class/1.1.0/class","arale/events/1.1.0/events","arale/templatable/0.9.2/templatable","gallery/handlebars/1.0.2/handlebars","./data-source","./filter","./input","./autocomplete.handlebars"],function(a,b,c){var d=a("$"),e=a("gallery/selection/0.9.0/selection"),f=a("./autocomplete"),g=f.extend({attrs:{cursor:!1},setup:function(){g.superclass.setup.call(this),this.sel=e(this.get("trigger"));var a=this.get("inputFilter"),b=this;this.set("inputFilter",function(c){var d=c.substring(0,b.sel.cursor()[1]);return a.call(b,d)}),this.get("cursor")&&(this.mirror=h.init(this.get("trigger")),this.dataSource.before("getData",function(){b.mirror.setContent(b.get("inputValue"),b.queryValue,b.sel.cursor())}))},_keyUp:function(a){this.get("visible")&&(a.preventDefault(),this.get("data").length&&this._step(-1))},_keyDown:function(a){this.get("visible")&&(a.preventDefault(),this.get("data").length&&this._step(1))},_keyEnter:function(a){this.get("visible")&&(this.currentItem?(a.preventDefault(),a.stopImmediatePropagation(),this.selectItem()):this.hide())},show:function(){var a=this.get("cursor");if(a){if(d.isArray(a))var b=a;else var b=[0,0];var c=this.mirror.getFlagRect(),e=this.get("align");e.baseXY=[c.left+b[0],c.bottom+b[1]],e.selfXY=[0,0],this.set("align",e)}g.superclass.show.call(this)},selectItem:function(){this.hide();var a=this.currentItem,b=this.get("selectedIndex"),c=this.get("data")[b];if(a){var d=a.attr("data-value"),e=this.sel.cursor()[1],f=e-this.queryValue.length;this.sel.cursor(f,e).text("").append(d,"right");var g=this.get("trigger").val();this.set("inputValue",g),this.mirror&&this.mirror.setContent(g,"",this.sel.cursor()),this.trigger("itemSelect",c),this._clear()}}}),h={mirror:null,css:["overflowY","height","width","paddingTop","paddingLeft","paddingRight","paddingBottom","marginTop","marginLeft","marginRight","marginBottom","fontFamily","borderStyle","borderWidth","wordWrap","fontSize","lineHeight","overflowX"],init:function(a){a=d(a);var b={position:"absolute",left:-9999,top:0,zIndex:-2e4,"white-space":"pre-wrap"};return d.each(this.css,function(c,d){return b[d]=a.css(d)}),this.mirror=d("<div><span></span></div>").css(b).insertAfter(a),this},setContent:function(a,b,c){var d=b?c[1]-b.length:c[1],e=c[1],f=["<span>",a.substring(0,d),"</span>",'<span id="flag">',b||"","</span>","<span>",a.substring(e),"</span>"].join("");return this.mirror.html(f),this},getFlagRect:function(){var a,b,c;return c=this.mirror.find("span#flag"),a=c.position(),b={left:a.left,right:c.width()+a.left,top:a.top,bottom:c.height()+a.top}}};c.exports=g}),define("arale/autocomplete/1.3.0/autocomplete",["$","arale/overlay/1.1.2/overlay","arale/position/1.0.1/position","arale/iframe-shim/1.0.2/iframe-shim","arale/widget/1.1.1/widget","arale/base/1.1.1/base","arale/class/1.1.0/class","arale/events/1.1.0/events","arale/templatable/0.9.2/templatable","gallery/handlebars/1.0.2/handlebars","arale/autocomplete/1.3.0/data-source","arale/autocomplete/1.3.0/filter","arale/autocomplete/1.3.0/input"],function(a,b,c){function d(a){return"[object String]"===Object.prototype.toString.call(a)}function e(a){return"[object Object]"===Object.prototype.toString.call(a)}function f(a,b){if(!a)return b;if(j.isFunction(a))return a.call(this,b);if(d(a)){for(var c=a.split("."),e=b;c.length;){var f=c.shift();if(!e[f])break;e=e[f]}return e}return b}function g(a){var b=[];return j.each(a,function(a,c){if(d(c))b.push({label:c,value:c,alias:[]});else if(e(c)){if(!c.value&&!c.label)return;c.value||(c.value=c.label),c.label||(c.label=c.value),c.alias||(c.alias=[]),b.push(c)}}),b}function h(a,b){return d(a)?a=n[a]?n[a]:n.startsWith:j.isFunction(a)||(a="url"===b.get("type")?n["default"]:n.startsWith),a}function i(a,b){var c=this.highlightIndex,d=0,e=a||this.label||"",f="";if(j.isArray(c)){for(var g=0,h=c.length;h>g;g++){var i,k,l=c[g];if(j.isArray(l)?(i=l[0],k=l[1]-l[0]):(i=l,k=1),i>d&&(f+=e.substring(d,i)),i<e.length){var m=b?'class="'+b+'-item-hl"':"";f+="<span "+m+">"+e.substr(i,k)+"</span>"}if(d=i+k,d>=e.length)break}return e.length>d&&(f+=e.substring(d,e.length)),f}return e}var j=a("$"),k=a("arale/overlay/1.1.2/overlay"),l=a("arale/templatable/0.9.2/templatable"),m=a("arale/autocomplete/1.3.0/data-source"),n=a("arale/autocomplete/1.3.0/filter"),o=a("arale/autocomplete/1.3.0/input"),p=/\bMSIE [678]\.0\b/.test(navigator.userAgent),q=a("arale/autocomplete/1.3.0/autocomplete.handlebars"),r=k.extend({Implements:l,attrs:{trigger:null,classPrefix:"ui-autocomplete",align:{baseXY:[0,"100%"]},submitOnEnter:!0,dataSource:[],locator:"data",filter:null,inputFilter:function(a){return a},disabled:!1,selectFirst:!1,delay:100,model:{value:{items:[]},getter:function(a){return a.classPrefix||(a.classPrefix=this.get("classPrefix")),a}},template:q,footer:"",header:"",html:"{{label}}",selectedIndex:null,data:[]},events:{mousedown:"_handleMouseDown","click [data-role=item]":"_handleSelection","mouseenter [data-role=item]":"_handleMouseMove","mouseleave [data-role=item]":"_handleMouseMove"},templateHelpers:{highlightItem:i},parseElement:function(){var a=["header","footer","html"];for(var b in a)this.templatePartials||(this.templatePartials={}),this.templatePartials[a[b]]=this.get(a[b]);r.superclass.parseElement.call(this)},setup:function(){r.superclass.setup.call(this),this._isOpen=!1,this._initInput(),this._initDataSource(),this._initFilter(),this._bindHandle(),this._blurHide([j(this.get("trigger"))]),this._tweakAlignDefaultValue()},show:function(){this._isOpen=!0,this._isEmpty()||r.superclass.show.call(this)},hide:function(){this._timeout&&clearTimeout(this._timeout),this.dataSource.abort(),this._hide()},destroy:function(){this._clear(),this.input&&(this.input.destroy(),this.input=null),r.superclass.destroy.call(this)},selectItem:function(a){this.items&&a&&this.items.length>a&&a>=-1&&(this.set("selectedIndex",a),this._handleSelection())},setInputValue:function(a){this.input.setValue(a)},_filterData:function(a){var b=this.get("filter"),c=this.get("locator");a=f(c,a),a=b.call(this,g(a),this.input.get("query")),this.set("data",a)},_onRenderData:function(a){a.length&&(this.set("model",{items:a,query:this.input.get("query")}),this.renderPartial(),this.items=this.$("[data-role=items]").children(),this.get("selectFirst")&&this.set("selectedIndex",0),this._isOpen&&this.show())},_onRenderSelectedIndex:function(a){var b=this.get("classPrefix")+"-item-hover";this.items&&this.items.removeClass(b),-1!==a&&(this.items.eq(a).addClass(b),this.trigger("indexChanged",a,this.lastIndex),this.lastIndex=a)},_initDataSource:function(){this.dataSource=new m({source:this.get("dataSource")})},_initInput:function(){this.input=new o({element:this.get("trigger"),delay:this.get("delay")})},_initFilter:function(){var a=this.get("filter");a=h(a,this.dataSource),this.set("filter",a)},_bindHandle:function(){this.dataSource.on("data",this._filterData,this),this.input.on("blur",this.hide,this).on("focus",this._handleFocus,this).on("keyEnter",this._handleSelection,this).on("keyEsc",this.hide,this).on("keyUp keyDown",this.show,this).on("keyUp keyDown",this._handleStep,this).on("queryChanged",this._clear,this).on("queryChanged",this._hide,this).on("queryChanged",this._handleQueryChange,this).on("queryChanged",this.show,this),this.after("hide",function(){this.set("selectedIndex",-1)}),this.on("itemSelected",function(){this._hide()})},_handleSelection:function(a){var b=a?"click"===a.type:!1,c=b?this.items.index(a.currentTarget):this.get("selectedIndex"),d=this.items.eq(c),e=this.get("data")[c];c>=0&&d&&(this.input.setValue(e.label),this.set("selectedIndex",c,{silent:!0}),!a||b||this.get("submitOnEnter")||a.preventDefault(),this.trigger("itemSelected",e,d))},_handleFocus:function(){this._isOpen=!0},_handleMouseMove:function(a){var b=this.get("classPrefix")+"-item-hover";if(this.items.removeClass(b),"mouseenter"===a.type){var c=this.items.index(a.currentTarget);this.set("selectedIndex",c,{silent:!0}),this.items.eq(c).addClass(b)}},_handleMouseDown:function(a){if(p){var b=this.input.get("element")[0];b.onbeforedeactivate=function(){window.event.returnValue=!1,b.onbeforedeactivate=null}}a.preventDefault()},_handleStep:function(a){a.preventDefault(),this.get("visible")&&this._step("keyUp"===a.type?-1:1)},_handleQueryChange:function(a){this.get("disabled")||(this.dataSource.abort(),this.dataSource.getData(a))},_step:function(a){var b=this.get("selectedIndex");-1===a?b>-1?this.set("selectedIndex",b-1):this.set("selectedIndex",this.items.length-1):1===a&&(b<this.items.length-1?this.set("selectedIndex",b+1):this.set("selectedIndex",-1))},_clear:function(){this.$("[data-role=items]").empty(),this.set("selectedIndex",-1),delete this.items,delete this.lastIndex},_hide:function(){this._isOpen=!1,r.superclass.hide.call(this)},_isEmpty:function(){var a=this.get("data");return!(a&&a.length>0)},_tweakAlignDefaultValue:function(){var a=this.get("align");a.baseElement=this.get("trigger"),this.set("align",a)}});c.exports=r}),define("arale/autocomplete/1.3.0/data-source",["arale/base/1.1.1/base","arale/class/1.1.0/class","arale/events/1.1.0/events","$"],function(a,b,c){function d(a){return"[object String]"===Object.prototype.toString.call(a)}function e(a){return a.replace(/^([a-z])/,function(a,b){return b.toUpperCase()})}var f=a("arale/base/1.1.1/base"),g=a("$"),h=f.extend({attrs:{source:null,type:"array"},initialize:function(a){h.superclass.initialize.call(this,a),this.id=0,this.callbacks=[];var b=this.get("source");if(d(b))this.set("type","url");else if(g.isArray(b))this.set("type","array");else if(g.isPlainObject(b))this.set("type","object");else{if(!g.isFunction(b))throw new Error("Source Type Error");this.set("type","function")}},getData:function(a){return this["_get"+e(this.get("type")||"")+"Data"](a)},abort:function(){this.callbacks=[]},_done:function(a){this.trigger("data",a)},_getUrlData:function(a){var b,c=this,d={query:a?encodeURIComponent(a):"",timestamp:(new Date).getTime()},e=this.get("source").replace(/{{(.*?)}}/g,function(a,b){return d[b]}),f="callback_"+this.id++;this.callbacks.push(f),b=/^(https?:\/\/)/.test(e)?{dataType:"jsonp"}:{dataType:"json"},g.ajax(e,b).success(function(a){g.inArray(f,c.callbacks)>-1&&(delete c.callbacks[f],c._done(a))}).error(function(){g.inArray(f,c.callbacks)>-1&&(delete c.callbacks[f],c._done({}))})},_getArrayData:function(){var a=this.get("source");return this._done(a),a},_getObjectData:function(){var a=this.get("source");return this._done(a),a},_getFunctionData:function(a){function b(a){c._done(a)}var c=this,d=this.get("source"),e=d.call(this,a,b);e&&this._done(e)}});c.exports=h}),define("arale/autocomplete/1.3.0/filter",["$"],function(a,b,c){function d(a){return(a||"").replace(h,"\\$1")}function e(a,b){for(var c=[],d=a.split(""),e=0,f=b.split(""),g=0,h=d.length;h>g;g++){var i=d[g];if(i===f[e]){if(e===f.length-1){c.push([g-f.length+1,g+1]),e=0;continue}e++}else e=0}return c}var f=a("$"),g={"default":function(a){return a},startsWith:function(a,b){b=b||"";var c=[],e=b.length,g=new RegExp("^"+d(b));return e?(f.each(a,function(a,b){for(var d,f=[b.value].concat(b.alias);d=f.shift();)if(g.test(d)){b.label===d&&(b.highlightIndex=[[0,e]]),c.push(b);break}}),c):[]},stringMatch:function(a,b){b=b||"";var c=[],d=b.length;return d?(f.each(a,function(a,d){for(var f,g=[d.value].concat(d.alias);f=g.shift();)if(f.indexOf(b)>-1){d.label===f&&(d.highlightIndex=e(f,b)),c.push(d);break}}),c):[]}};c.exports=g;var h=/(\[|\[|\]|\^|\$|\||\(|\)|\{|\}|\+|\*|\?)/g}),define("arale/autocomplete/1.3.0/input",["$","arale/base/1.1.1/base","arale/class/1.1.0/class","arale/events/1.1.0/events"],function(a,b,c){function d(a,b){return function(){a.apply(b,arguments)}}function e(a,b){return a=(a||"").replace(/^\s*/g,"").replace(/\s{2,}/g," "),b=(b||"").replace(/^\s*/g,"").replace(/\s{2,}/g," "),a===b}function f(a){return a.charAt(0).toUpperCase()+a.substring(1)}var g=a("$"),h=a("arale/base/1.1.1/base"),i=/\bMSIE [6789]\.0\b/.test(navigator.userAgent),j={9:"tab",27:"esc",37:"left",39:"right",13:"enter",38:"up",40:"down"},k=h.extend({attrs:{element:{value:null,setter:function(a){return g(a)}},query:null,delay:100},initialize:function(){k.superclass.initialize.apply(this,arguments),this._bindEvents(),this.set("query",this.getValue())},focus:function(){this.get("element").focus()},getValue:function(){return this.get("element").val()},setValue:function(a,b){this.get("element").val(a),!b&&this._change()},destroy:function(){k.superclass.destroy.call(this)},_onRenderValue:function(){this._change()},_bindEvents:function(){var a,b=this.get("element");if(b.attr("autocomplete","off").on("focus.autocomplete",d(this._handleFocus,this)).on("blur.autocomplete",d(this._handleBlur,this)).on("keydown.autocomplete",d(this._handleKeydown,this)).on("keyUp.autocomplete",d(this._handleKeyup,this)),i){var c=this,e=["keydown.autocomplete","keypress.autocomplete","cut.autocomplete","paste.autocomplete"].join(" ");b.on(e,d(function(b){j[b.which]||(clearTimeout(a),a=setTimeout(function(){c._change.call(c,b)},this.get("delay")))},this))}else b.on("input.autocomplete",d(this._change,this))},_change:function(){var a=this.getValue(),b=this.get("query"),c=e(b,a),d=c?a.length!==b.length:!1;d&&this.trigger("whitespaceChanged",b),c||(this.set("query",a),this.trigger("queryChanged",a,b))},_handleFocus:function(a){this.trigger("focus",a)},_handleBlur:function(a){this.trigger("blur",a)},_handleKeydown:function(a){var b=j[a.which];if(b){var c="key"+f(b);this.trigger(a.type=c,a)}}});c.exports=k}),define("arale/autocomplete/1.3.0/autocomplete.handlebars",["gallery/handlebars/1.0.2/runtime"],function(a,b,c){var d=a("gallery/handlebars/1.0.2/runtime"),e=d.template;c.exports=e(function(a,b,c,d,e){function f(a,b,e){var f,g,h="";return h+='\n    <li data-role="item" class="'+k((f=e.classPrefix,typeof f===j?f.apply(a):f))+'-item">',g=l.invokePartial(d.html,"html",a,c,d,b),(g||0===g)&&(h+=g),h+="</li>\n  "}this.compilerInfo=[3,">= 1.0.0-rc.4"],c=c||{};for(var g in a.helpers)c[g]=c[g]||a.helpers[g];d=d||a.partials,e=e||{};var h,i="",j="function",k=this.escapeExpression,l=this;return i+='<div class="',(h=c.classPrefix)?h=h.call(b,{hash:{},data:e}):(h=b.classPrefix,h=typeof h===j?h.apply(b):h),i+=k(h)+'">\n  ',h=l.invokePartial(d.header,"header",b,c,d,e),(h||0===h)&&(i+=h),i+='\n  <ul class="',(h=c.classPrefix)?h=h.call(b,{hash:{},data:e}):(h=b.classPrefix,h=typeof h===j?h.apply(b):h),i+=k(h)+'-ctn" data-role="items">\n  ',h=c.each.call(b,b.items,{hash:{},inverse:l.noop,fn:l.programWithDepth(1,f,e,b),data:e}),(h||0===h)&&(i+=h),i+="\n  </ul>\n  ",h=l.invokePartial(d.footer,"footer",b,c,d,e),(h||0===h)&&(i+=h),i+="\n</div>\n"})});
